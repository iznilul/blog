# 蘑菇博客修改部分默认密码

[TOC]

## 前言

刚刚用蘑菇博客搭起来网站，突然想起来如果数据库，nacos和后台都用的默认密码，看过部署博客就能连接，那不就跟裸奔一样QvQ 

所以拒绝裸奔从我做起，水一篇博客讲讲怎么修改部分配置密码（用到的部分，一部分还有没有用到所以没写）

## 博客镜像

一般像我这种菜鸡为了省事都是直接拉的博客镜像，运行再某某端口上，22端口谁都可以连，而这个镜像有默认密码，所以需要改一下

进入博客镜像后

`passwd root`

接着输入新的密码两遍就可以了

还有一种方式是设置密钥登录

首先在博客镜像里输入命令

`ssh-keygen`

接着一路回车,在root目录下生成三个文件

![img](http://image.radcircle.love/2d830a8d360845f2bf2b6451667d3e9e)

然后我们把**本地机器**（c盘用户.ssh文件夹里）生成的公钥id.rsa.pub，具体操作可以谷歌，跟Linux差不多，复制到云服务器/root/.ssh/authorized_keys里

然后就可以用远程连接工具进行连接了

## Mysql

这里mysql.user表里设置的密码，本地连接和远程连接是一样的

我们需要修改远程连接的密码

 `SET PASSWORD FOR 'root'@'%' = PASSWORD('newpass');`

`flush privileges;`

## Redis

redis的话需要修改本地/soft/redis/redis.conf

`sed 's/原字符串/替换字符串/'`

然后kill  -9掉redis进程

 `./redis-server redis.conf`

重新启动

## nacos

在服务器的数据库有一个nacos_config里有users表，里面是这样

![img](http://image.radcircle.love/f4e1617dd6804ce4ba2c715d608db880)

密码被加密了，如何修改？

我的做法是在拉一个蘑菇博客的开源代码到本地（反正以后可能要帮忙维护嘛）

\mogu_blog_v2\mogu_admin\src\main\java\com\moxi\mogublog\admin\security\

路径下新建一个java类

 ```
package com.moxi.mogublog.admin.security;
import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;

/**
 * Password encoder tool
 *
 * @author nacos
 */
public class password {

    public static void main(String[] args) {
        System.out.println(new BCryptPasswordEncoder().encode("password"));
    }
}
 ```

讲输出的加密完的密码复制到users表里，就完成nacos密码更新了

## 项目部署

接下来是把新的密码部署到线上

登录8848端口，输入刚刚更新的nacos账户密码

在prod的mogu_admin mogu_web下更新redis的密码（mysql因为只修改了远程连接用户的密码，如果本地root修改过了就进行更新）

![img](http://image.radcircle.love/57fc2c6bab7e48dd9a768021a8eb49fa)

接下来把正在跑的服务模块都先停下来，/home/mogu_blog  每个正在运行模块shutdown.sh

修改每一个模块下的config/bootstrap.yml 的nacos密码

![img](http://image.radcircle.love/2b71d34c691d487687e048197d809d50)

 然后重新start.sh就可以了

## 结语

修改默认密码的方式暂时就这么多，如果用到了其他服务还会更新，谢谢OvO